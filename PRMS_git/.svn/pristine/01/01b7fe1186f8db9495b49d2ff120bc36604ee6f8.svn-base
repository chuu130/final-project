/*********** 유틸 메소드 ***********/

/* formData to JSON 데이터 변환 */
const formDataToJSON = (form) => {

	let formData = new FormData(form);
	let data = {};

	for(let name of formData.keys()) {
		let value = formData.get(name);
		data[name] = value;
	}

	return JSON.stringify(data);
}


const updateFranBoard = (form) => axios({
							        method: 'put',
							        url: form.action,
									headers:{
										"content-type":"application/json",
										"accept":"application/json"
									},
							        data: formDataToJSON(form)
							  	});


/*********** 메인 메소드 ***********/
const showUpdateView = () => {
	v_mainView.style.display = "none";
	v_updateView.style.display = "block";
}

const showMainView = () => {
	v_updateView.style.display = "none";
	v_mainView.style.display = "block";
}

const modifyFranBoard = async (e) => {

	// 전송 이벤트를 막는다.
	e.preventDefault();

	// 입력값을 가져온다.
	let form = e.target;
//	console.log(form);

	// 입력값을 전송한다.
	let jsonData = await updateFranBoard(form);
	let rslt = jsonData.data;

	if(rslt.success) {
		Swal.fire({
			title : '수정완료!',
			text : '게시글이 정상적으로 수정되었습니다.',
			icon : 'success'
		}).then(result => {
			if(result.isConfirmed) {
				location.reload(true);
			}
		});
	} else {
		Swal.fire({
			title : '수정실패!',
			text : rslt.message ?? JSON.stringify(rslt.errors),
			icon : 'error'
		});
		for(let prop in rslt.errors) {
			if(form[prop]) {
				console.log(rslt.errors[prop]);
				form[prop].focus();
				break;
			}
		}
	}
}

/*********** DOM ***********/
let v_mainView = document.querySelector("#mainView");
let v_updateView = document.querySelector("#updateView");
let v_updateForm = document.querySelector("#updateForm");

let v_btnUpdate = document.querySelector("#btnUpdate");
let v_btnDelete = document.querySelector("#btnDelete");
let v_submitUpdate = document.querySelector("#submitUpdate");
let v_cancelUpdate = document.querySelector("#cancelUpdate");


/*********** 이벤트 등록부 ***********/
document.addEventListener("DOMContentLoaded", () => {

	/* 메인뷰에서 수정버튼 처리 */
	v_btnUpdate.addEventListener("click", showUpdateView);

	/* 메인뷰에서 삭제버튼 처리 */


	/* 업데이트뷰에서 수정버튼 처리 */
	v_updateForm.addEventListener("submit", modifyFranBoard);


	/* 업데이트뷰에서 취소버튼 처리 */
	v_cancelUpdate.addEventListener("click", showMainView);

});