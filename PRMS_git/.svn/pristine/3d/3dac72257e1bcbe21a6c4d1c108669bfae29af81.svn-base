<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.franchise.franchisee.mapper.FranBoardMapper">

	<sql id="franBoardColumns">
		FRAN_BOARD_NO
		, FRAN_BOARD_TITLE
		, FRAN_BOARD_CONT
		, FRAN_BOARD_DT
		, FRAN_BOARD_HIT
		, EMP_ID
		, ATCH_FILE_ID
	</sql>

	<!-- 검색조건(제목, 작성자, 내용)을 활용한 쿼리 -->
<!-- 	<sql id="searchFlag"> -->
<!-- 		<if test="simpleCondition.searchWord != null and simpleCondition.searchWord != ''"> -->
<!-- 			<trim prefix ="AND"> -->
<!-- 				<choose> -->
<!-- 					<when test="simpleCondition.searchType eq 'title'"> -->
<!-- 						INSTR(FRAN_BOARD_TITLE, #{simpleCondition.searchWord}) > 0 -->
<!-- 					</when> -->
<!-- 					<when test="simpleCondition.searchType eq 'writer'"> -->
<!-- 						INSTR(FRAN_BOARD_WRITER, #{simpleCondition.searchWord}) > 0 -->
<!-- 					</when> -->
<!-- 					<when test="simpleCondition.searchType eq 'content'"> -->
<!-- 						INSTR(FRAN_BOARD_CONT, #{simpleCondition.searchWord}) > 0 -->
<!-- 					</when> -->
<!-- 					<otherwise> -->
<!-- 						INSTR(FRAN_BOARD_TITLE, #{simpleCondition.searchWord}) > 0 -->
<!-- 						OR INSTR(FRAN_BOARD_WRITER, #{simpleCondition.searchWord}) > 0 -->
<!-- 						OR INSTR(FRAN_BOARD_CONT, #{simpleCondition.searchWord}) > 0 -->
<!-- 					</otherwise> -->
<!-- 				</choose> -->
<!-- 			</trim> -->
<!-- 		</if> -->
<!-- 	</sql> -->

	<!-- 가맹점게시판의 총레코드 개수를 조회하는 쿼리 -->
	<select id="selectTotalRecord" parameterType="kr.or.ddit.commons.paging.PaginationInfo" resultType="int">
		SELECT COUNT(FRAN_BOARD_NO)
		FROM FRAN_BOARD
		<if test="searchWord != null and searchWord != ''">
			WHERE
				INSTR(FRAN_BOARD_TITLE, #{searchWord}) > 0
				OR INSTR(EMP_ID, #{searchWord}) > 0
				OR INSTR(FRAN_BOARD_CONT, #{searchWord}) > 0
		</if>
	</select>


	<!-- 가맹점게시판을 조회하는 쿼리(페이징 O) -->
	<select id="selectFranBoardList" parameterType="kr.or.ddit.commons.paging.PaginationInfo" resultType="kr.or.ddit.vo.FranBoardVO">
		SELECT B.*
		FROM (
			SELECT ROWNUM RNUM, A.*
			FROM (
				SELECT
					<include refid="franBoardColumns" />
				FROM FRAN_BOARD
				WHERE
					FRAN_BOARD_DELYN = 'N'
					<if test="searchWord != null and searchWord != ''">
						AND
							INSTR(FRAN_BOARD_TITLE, #{searchWord}) > 0
							OR INSTR(EMP_ID, #{searchWord}) > 0
							OR INSTR(FRAN_BOARD_CONT, #{searchWord}) > 0
					</if>
				ORDER BY
					FRAN_BOARD_NO DESC
			) A
		) B
		WHERE RNUM BETWEEN #{firstRecord} AND #{lastRecord}
	</select>

	<!-- 가맹점게시판을 조회하는 쿼리(페이징 X) -->
	<select id="selectFranBoardListNonPaging" resultType="kr.or.ddit.vo.FranBoardVO">
		SELECT A.*, ROWNUM RNUM
		FROM (
			SELECT
				<include refid="franBoardColumns" />
			FROM FRAN_BOARD
			WHERE
				FRAN_BOARD_DELYN = 'N'
			ORDER BY FRAN_BOARD_NO DESC
		) A
	</select>

	<!-- 가맹점게시판을 상세조회하는 쿼리 -->
	<select id="selectFranBoard" parameterType="int" resultType="kr.or.ddit.vo.FranBoardVO">
		SELECT
			<include refid="franBoardColumns" />
		FROM FRAN_BOARD
		WHERE FRAN_BOARD_NO = #{franBoardNo}
	</select>

	<!-- 게시글을 수정하는 쿼리 -->
	<update id="updateFranBoard" parameterType="FranBoardVO">
		UPDATE FRAN_BOARD
		SET FRAN_BOARD_TITLE = #{franBoardTitle}, FRAN_BOARD_CONT = #{franBoardCont}
		WHERE FRAN_BOARD_NO = #{franBoardNo}
	</update>

</mapper>